<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ›ãƒ©ãƒ¼</title>
    <link rel="stylesheet" href="style.css">
    </head>
<body>

<div id="container" class="landing-page">
    <h1>AIã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ›ãƒ©ãƒ¼ ğŸ‘»</h1>

    <p class="description">
        AIãŒèªã‚‹ãƒ›ãƒ©ãƒ¼ç‰©èªã«ã€ã‚ãªãŸã®å£°ã¨è¡¨æƒ…ã€ãã—ã¦ãƒ‡ãƒã‚¤ã‚¹ã®å‹•ãã§ä»‹å…¥ã—ã¾ã—ã‚‡ã†ã€‚
        ææ€–ã®å±•é–‹ã¯ã€ã‚ãªãŸã®åå¿œæ¬¡ç¬¬ã§å¤‰åŒ–ã—ã¾ã™ã€‚
    </p>

    <div class="landing-buttons">
        <button id="start-game-btn" class="landing-button">æ€ªè«‡é–‹å§‹</button>
        <a href="/history.html" class="landing-button history-button">ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´</a>
    </div>

    <div id="permission-check-area" style="display: none;">
        <video id="permission-video-preview" autoplay muted playsinline style="width:1px; height:1px; position:absolute; top:0; left:0;"></video>
    </div>
    <div id="permission-message" class="error-message" style="display: none; margin-top: 20px;"></div>

</div>

<script>
    // æœ€åˆã®ãƒšãƒ¼ã‚¸ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    document.addEventListener('DOMContentLoaded', () => {
        const startGameBtn = document.getElementById('start-game-btn');
        const permissionVideoPreview = document.getElementById('permission-video-preview');
        const permissionMessage = document.getElementById('permission-message');

        startGameBtn.addEventListener('click', async () => {
            // ã‚«ãƒ¡ãƒ©ã¨ãƒã‚¤ã‚¯ã®è¨±å¯ã‚’å–ã‚‹
            permissionMessage.style.display = 'block';
            permissionMessage.textContent = 'ã‚«ãƒ¡ãƒ©ã¨ãƒã‚¤ã‚¯ã®è¨±å¯ã‚’æ±‚ã‚ã¦ã„ã¾ã™...';

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });

                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã—ãªã„ãŒã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä¸€æ™‚çš„ã«videoè¦ç´ ã«å‰²ã‚Šå½“ã¦ã¦ãŠã
                // ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯è¨±å¯ãŒå–ã‚ŒãŸã¨èªè­˜ã—ã€ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºãªã©ã‚’æ›´æ–°ã™ã‚‹
                if (permissionVideoPreview) {
                    permissionVideoPreview.srcObject = stream;
                }

                // åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚‚ã“ã“ã§è©¦ã¿ã‚‹ï¼ˆiOS 13+ï¼‰
                if (typeof DeviceMotionEvent.requestPermission === 'function') {
                    try {
                        const permissionState = await DeviceMotionEvent.requestPermission();
                        if (permissionState === 'granted') {
                            console.log('åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸã€‚');
                        } else {
                            console.warn('åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ææ€–åº¦æ¨å®šã®ç²¾åº¦ãŒè½ã¡ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                            permissionMessage.textContent += ' (åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®åˆ©ç”¨ãŒè¨±å¯ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ)';
                        }
                    } catch (error) {
                        console.error('åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¦æ±‚ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                        permissionMessage.textContent += ' (åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³è¦æ±‚ä¸­ã«ã‚¨ãƒ©ãƒ¼)';
                    }
                } else {
                    console.log('åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³APIã¯ä¸è¦ã§ã™ã€‚');
                }

                permissionMessage.textContent = 'è¨±å¯ãŒå–å¾—ã§ãã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¾ã™...';
                // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢ã—ã€ãƒ‡ãƒã‚¤ã‚¹ã®LEDãªã©ã‚’æ¶ˆç¯ã•ã›ã‚‹
                stream.getTracks().forEach(track => track.stop());
                
                // ã‚²ãƒ¼ãƒ æœ¬ä½“ã®ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.location.href = '/game.html';

            } catch (err) {
                console.error("ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒã‚¤ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—:", err);
                permissionMessage.textContent = 'ã‚«ãƒ¡ãƒ©ã¾ãŸã¯ãƒã‚¤ã‚¯ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                startGameBtn.disabled = false; // ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹ã«ã™ã‚‹
            }
        });
    });
</script>

<style>
    .landing-page {
        text-align: center;
        padding: 50px;
        margin-top: 100px;
    }
    .landing-page h1 {
        font-size: 2.5em;
        margin-bottom: 30px;
    }
    .landing-page .description {
        font-size: 1.1em;
        line-height: 1.8;
        margin-bottom: 40px;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }
    .landing-buttons {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 300px;
        margin: 0 auto;
    }
    .landing-button {
        padding: 15px 30px;
        border-radius: 8px;
        border: none;
        background-color: #bb86fc; /* Primary color */
        color: #121212;
        font-weight: bold;
        font-size: 1.2em;
        cursor: pointer;
        transition: background-color 0.3s ease;
        text-decoration: none; /* for anchor tag */
        display: block; /* for anchor tag to behave like a block button */
    }
    .landing-button:hover {
        background-color: #8a2be2; /* Darker purple on hover */
    }
    .landing-button.history-button {
        background-color: #03dac6; /* Secondary color */
        color: #121212;
    }
    .landing-button.history-button:hover {
        background-color: #018786; /* Darker teal on hover */
    }
</style>

</body>
</html>